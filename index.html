<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Automator - AI-Powered Webflow Publishing</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function BlogAutomator() {
            const [step, setStep] = useState(1);
            const [topic, setTopic] = useState('');
            const [generatedContent, setGeneratedContent] = useState(null);
            const [isGenerating, setIsGenerating] = useState(false);
            const [isPublishing, setIsPublishing] = useState(false);
            const [editableContent, setEditableContent] = useState('');
            const [showSuccess, setShowSuccess] = useState(false);
            const [error, setError] = useState('');

            // API Configuration - USER FILLS THESE IN
            const [apiConfig, setApiConfig] = useState({
                provider: 'groq', // 'claude', 'groq', or 'openai'
                apiKey: '', // USER ENTERS THEIR API KEY HERE
                model: 'llama-3.3-70b-versatile' // Default Groq model
            });

            // Webflow configuration
            const [webflowConfig, setWebflowConfig] = useState({
                apiToken: '', // USER ENTERS WEBFLOW API TOKEN
                collectionId: '', // USER ENTERS COLLECTION ID
                siteId: '' // USER ENTERS SITE ID
            });

            // =================================================================
            // REAL API CALL - GROQ (RECOMMENDED - FREE & FAST)
            // =================================================================
            const generateWithGroq = async (topic) => {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiConfig.apiKey}`
                    },
                    body: JSON.stringify({
                        model: apiConfig.model,
                        messages: [{
                            role: 'user',
                            content: `You are an expert SEO content writer for a limousine service business.

Write a comprehensive, SEO-optimized blog post about: "${topic}"

Requirements:
- 1500-2000 words
- Use HTML formatting with <h2>, <h3>, <p>, <ul>, <ol>, <strong> tags
- Include an engaging introduction
- Create 5-7 main sections with descriptive headings
- Include actionable tips and insights
- End with a strong conclusion
- Optimize for keywords related to: ${topic}
- Write in a professional but approachable tone

IMPORTANT: Return ONLY the HTML content. No markdown, no code blocks, just pure HTML starting with <h2> tags.`
                        }],
                        temperature: 0.7,
                        max_tokens: 4000
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Groq API error');
                }

                const data = await response.json();
                return data.choices[0].message.content;
            };

            // =================================================================
            // REAL API CALL - CLAUDE (ANTHROPIC)
            // =================================================================
            const generateWithClaude = async (topic) => {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiConfig.apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 4000,
                        messages: [{
                            role: 'user',
                            content: `You are an expert SEO content writer for a limousine service business.

Write a comprehensive, SEO-optimized blog post about: "${topic}"

Requirements:
- 1500-2000 words
- Use HTML formatting with <h2>, <h3>, <p>, <ul>, <ol>, <strong> tags
- Include an engaging introduction
- Create 5-7 main sections with descriptive headings
- Include actionable tips and insights
- End with a strong conclusion
- Optimize for keywords related to: ${topic}
- Write in a professional but approachable tone

IMPORTANT: Return ONLY the HTML content. No markdown, no code blocks, just pure HTML starting with <h2> tags.`
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Claude API error');
                }

                const data = await response.json();
                return data.content[0].text;
            };

            // =================================================================
            // REAL API CALL - OPENAI
            // =================================================================
            const generateWithOpenAI = async (topic) => {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiConfig.apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [{
                            role: 'user',
                            content: `You are an expert SEO content writer for a limousine service business.

Write a comprehensive, SEO-optimized blog post about: "${topic}"

Requirements:
- 1500-2000 words
- Use HTML formatting with <h2>, <h3>, <p>, <ul>, <ol>, <strong> tags
- Include an engaging introduction
- Create 5-7 main sections with descriptive headings
- Include actionable tips and insights
- End with a strong conclusion
- Optimize for keywords related to: ${topic}
- Write in a professional but approachable tone

IMPORTANT: Return ONLY the HTML content. No markdown, no code blocks, just pure HTML starting with <h2> tags.`
                        }],
                        temperature: 0.7,
                        max_tokens: 4000
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'OpenAI API error');
                }

                const data = await response.json();
                return data.choices[0].message.content;
            };

            // =================================================================
            // MAIN GENERATE FUNCTION - ROUTES TO CORRECT API
            // =================================================================
            const generateContent = async () => {
                setIsGenerating(true);
                setError('');

                // Check if API key is provided
                if (!apiConfig.apiKey) {
                    setError('Please enter your API key in the settings below');
                    setIsGenerating(false);
                    return;
                }

                try {
                    let generatedHtml;

                    // Route to correct API based on provider
                    switch(apiConfig.provider) {
                        case 'groq':
                            generatedHtml = await generateWithGroq(topic);
                            break;
                        case 'claude':
                            generatedHtml = await generateWithClaude(topic);
                            break;
                        case 'openai':
                            generatedHtml = await generateWithOpenAI(topic);
                            break;
                        default:
                            throw new Error('Invalid API provider selected');
                    }

                    // Clean the output (remove markdown code blocks if present)
                    generatedHtml = generatedHtml.replace(/```html\n?/g, '').replace(/```\n?/g, '');

                    // Extract title from first H2
                    const titleMatch = generatedHtml.match(/<h2>(.*?)<\/h2>/i);
                    const title = titleMatch ? titleMatch[1].replace(/<[^>]*>/g, '') : `The Ultimate Guide to ${topic}`;

                    // Generate slug
                    const slug = title
                        .toLowerCase()
                        .replace(/[^a-z0-9]+/g, '-')
                        .replace(/^-+|-+$/g, '');

                    // Generate meta description
                    const textContent = generatedHtml.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
                    const metaDescription = textContent.substring(0, 157) + '...';

                    // Count words
                    const wordCount = textContent.split(/\s+/).length;

                    // Analyze for internal links
                    const internalLinks = analyzeForInternalLinks(generatedHtml, topic);

                    // Suggest categories
                    const categories = suggestCategories(topic);

                    const content = {
                        title,
                        slug,
                        body: generatedHtml,
                        metaDescription,
                        wordCount,
                        internalLinks,
                        suggestedCategories: categories
                    };

                    setGeneratedContent(content);
                    setEditableContent(content.body);
                    setIsGenerating(false);
                    setStep(2);

                } catch (err) {
                    console.error('Generation error:', err);
                    setError(`Error: ${err.message}`);
                    setIsGenerating(false);
                }
            };

            // Helper: Analyze for internal linking opportunities
            const analyzeForInternalLinks = (content, topic) => {
                const links = [];
                const linkingOpportunities = [
                    { keyword: 'airport transfer', url: '/blog/airport-transfer-guide' },
                    { keyword: 'luxury transportation', url: '/blog/luxury-transportation-services' },
                    { keyword: 'corporate events', url: '/blog/corporate-event-transportation' },
                    { keyword: 'wedding car', url: '/blog/wedding-limousine-guide' },
                    { keyword: 'chauffeur service', url: '/blog/professional-chauffeur-services' },
                ];

                linkingOpportunities.forEach(opportunity => {
                    const regex = new RegExp(opportunity.keyword, 'gi');
                    const matches = content.match(regex);
                    if (matches && matches.length > 0) {
                        links.push({
                            anchor: opportunity.keyword,
                            url: opportunity.url,
                            occurrences: matches.length
                        });
                    }
                });

                return links.slice(0, 3);
            };

            // Helper: Suggest categories
            const suggestCategories = (topic) => {
                const categories = ['Guides'];
                const categoryMap = {
                    'airport': ['Travel Tips', 'Airport Services'],
                    'wedding': ['Wedding Planning', 'Special Events'],
                    'corporate': ['Corporate Services', 'Business Travel'],
                    'luxury': ['Luxury Services', 'Premium Options'],
                };

                const topicLower = topic.toLowerCase();
                Object.entries(categoryMap).forEach(([keyword, cats]) => {
                    if (topicLower.includes(keyword)) {
                        categories.push(...cats);
                    }
                });

                return [...new Set(categories)].slice(0, 3);
            };

            // =================================================================
            // PUBLISH TO WEBFLOW - REAL API CALL
            // =================================================================
            const publishToWebflow = async () => {
                setIsPublishing(true);
                setError('');

                // Check if Webflow credentials are provided
                if (!webflowConfig.apiToken || !webflowConfig.collectionId) {
                    // Demo mode
                    setTimeout(() => {
                        setIsPublishing(false);
                        setShowSuccess(true);
                        setTimeout(() => {
                            setShowSuccess(false);
                            setStep(1);
                            setTopic('');
                            setGeneratedContent(null);
                            setEditableContent('');
                        }, 3000);
                    }, 2000);
                    return;
                }

                try {
                    // Real Webflow API call
                    const response = await fetch(`https://api.webflow.com/v2/collections/${webflowConfig.collectionId}/items`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${webflowConfig.apiToken}`,
                            'Content-Type': 'application/json',
                            'accept': 'application/json'
                        },
                        body: JSON.stringify({
                            fieldData: {
                                name: generatedContent.title,
                                slug: generatedContent.slug,
                                'post-body': editableContent,
                                'meta-description': generatedContent.metaDescription,
                            },
                            isDraft: false,
                            isArchived: false
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Webflow API error');
                    }

                    const data = await response.json();

                    // Optionally publish the site
                    if (webflowConfig.siteId) {
                        await fetch(`https://api.webflow.com/v2/sites/${webflowConfig.siteId}/publish`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${webflowConfig.apiToken}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ itemIds: [data.id] })
                        });
                    }

                    setIsPublishing(false);
                    setShowSuccess(true);
                    setTimeout(() => {
                        setShowSuccess(false);
                        setStep(1);
                        setTopic('');
                        setGeneratedContent(null);
                        setEditableContent('');
                    }, 3000);

                } catch (err) {
                    console.error('Publish error:', err);
                    setError(`Publishing error: ${err.message}`);
                    setIsPublishing(false);
                }
            };

            return (
                <div className="min-h-screen gradient-bg py-12 px-4">
                    {/* Header */}
                    <div className="max-w-6xl mx-auto mb-12">
                        <div className="text-center text-white">
                            <h1 className="text-5xl font-bold mb-4">Blog Automator</h1>
                            <p className="text-xl opacity-90">AI-Powered Content Generation ‚Üí Webflow Publishing</p>
                            <p className="text-sm opacity-75 mt-2">Save 10+ minutes per blog post</p>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-6xl mx-auto">
                        <div className="glass-effect rounded-2xl shadow-2xl p-8">
                            {/* Error Display */}
                            {error && (
                                <div className="mb-6 bg-red-50 border border-red-200 rounded-lg p-4">
                                    <p className="text-red-800 text-sm">‚ö†Ô∏è {error}</p>
                                </div>
                            )}

                            {/* Progress Steps */}
                            <div className="flex items-center justify-center mb-12">
                                <div className="flex items-center space-x-4">
                                    <div className={`flex items-center justify-center w-12 h-12 rounded-full ${step >= 1 ? 'bg-purple-600 text-white' : 'bg-gray-300 text-gray-600'} font-bold`}>
                                        1
                                    </div>
                                    <div className={`w-24 h-1 ${step >= 2 ? 'bg-purple-600' : 'bg-gray-300'}`}></div>
                                    <div className={`flex items-center justify-center w-12 h-12 rounded-full ${step >= 2 ? 'bg-purple-600 text-white' : 'bg-gray-300 text-gray-600'} font-bold`}>
                                        2
                                    </div>
                                </div>
                            </div>

                            {/* Step 1: Input Topic */}
                            {step === 1 && (
                                <div className="max-w-2xl mx-auto">
                                    <h2 className="text-3xl font-bold text-gray-800 mb-6 text-center">
                                        What's your blog topic?
                                    </h2>
                                    <div className="space-y-4">
                                        <input
                                            type="text"
                                            value={topic}
                                            onChange={(e) => setTopic(e.target.value)}
                                            placeholder="e.g., Airport Transfer Services in Singapore"
                                            className="w-full px-6 py-4 text-lg border-2 border-gray-300 rounded-xl focus:border-purple-600 focus:outline-none transition"
                                        />
                                        <button
                                            onClick={generateContent}
                                            disabled={!topic || isGenerating || !apiConfig.apiKey}
                                            className={`w-full py-4 text-lg font-semibold rounded-xl transition ${
                                                !topic || isGenerating || !apiConfig.apiKey
                                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                    : 'bg-purple-600 text-white hover:bg-purple-700 shadow-lg hover:shadow-xl'
                                            }`}
                                        >
                                            {isGenerating ? (
                                                <span className="flex items-center justify-center">
                                                    <svg className="animate-spin h-6 w-6 mr-3" viewBox="0 0 24 24">
                                                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none"></circle>
                                                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                    </svg>
                                                    Generating with {apiConfig.provider.toUpperCase()}...
                                                </span>
                                            ) : (
                                                'üöÄ Generate Blog Post with AI'
                                            )}
                                        </button>
                                    </div>

                                    {/* Example Topics */}
                                    <div className="mt-8">
                                        <p className="text-sm text-gray-600 mb-3">Quick examples:</p>
                                        <div className="flex flex-wrap gap-2">
                                            {[
                                                'Luxury Limousine Services',
                                                'Corporate Transportation Solutions',
                                                'Wedding Car Rental Guide',
                                                'Airport Shuttle Services'
                                            ].map((example) => (
                                                <button
                                                    key={example}
                                                    onClick={() => setTopic(example)}
                                                    className="px-4 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition text-sm"
                                                >
                                                    {example}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Step 2: Preview & Edit */}
                            {step === 2 && generatedContent && (
                                <div className="space-y-6">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-3xl font-bold text-gray-800">
                                            Review Your Content
                                        </h2>
                                        <button
                                            onClick={() => setStep(1)}
                                            className="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition"
                                        >
                                            ‚Üê Start Over
                                        </button>
                                    </div>

                                    {/* Metadata */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">Title</label>
                                            <input
                                                type="text"
                                                value={generatedContent.title}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                                readOnly
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">Slug</label>
                                            <input
                                                type="text"
                                                value={generatedContent.slug}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                                readOnly
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Meta Description</label>
                                        <textarea
                                            value={generatedContent.metaDescription}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                            rows="2"
                                            readOnly
                                        ></textarea>
                                    </div>

                                    {/* Content Editor */}
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                                            Content (Editable) - {generatedContent.wordCount} words
                                        </label>
                                        <textarea
                                            value={editableContent}
                                            onChange={(e) => setEditableContent(e.target.value)}
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg font-mono text-sm"
                                            rows="20"
                                        ></textarea>
                                    </div>

                                    {/* Internal Links */}
                                    {generatedContent.internalLinks.length > 0 && (
                                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                            <h3 className="font-semibold text-blue-900 mb-2">üí° Suggested Internal Links:</h3>
                                            <ul className="space-y-1 text-sm">
                                                {generatedContent.internalLinks.map((link, idx) => (
                                                    <li key={idx} className="text-blue-700">
                                                        ‚Üí Link "<strong>{link.anchor}</strong>" to: <code className="bg-blue-100 px-2 py-1 rounded">{link.url}</code>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>
                                    )}

                                    {/* Categories */}
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">Suggested Categories</label>
                                        <div className="flex flex-wrap gap-2">
                                            {generatedContent.suggestedCategories.map((cat, idx) => (
                                                <span key={idx} className="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm">
                                                    {cat}
                                                </span>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Publish Button */}
                                    <button
                                        onClick={publishToWebflow}
                                        disabled={isPublishing}
                                        className={`w-full py-4 text-lg font-semibold rounded-xl transition ${
                                            isPublishing
                                                ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                : 'bg-green-600 text-white hover:bg-green-700 shadow-lg'
                                        }`}
                                    >
                                        {isPublishing ? 'Publishing...' : '‚úÖ Publish to Webflow'}
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* API Configuration Panel */}
                        <div className="mt-8 glass-effect rounded-xl p-6">
                            <h3 className="text-lg font-semibold text-gray-800 mb-4">üîë API Configuration (Required)</h3>
                            
                            {/* API Provider Selection */}
                            <div className="mb-4">
                                <label className="block text-xs font-semibold text-gray-700 mb-2">AI Provider</label>
                                <select 
                                    value={apiConfig.provider}
                                    onChange={(e) => setApiConfig({...apiConfig, provider: e.target.value})}
                                    className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"
                                >
                                    <option value="groq">Groq (Free & Fast) ‚ö° RECOMMENDED</option>
                                    <option value="claude">Claude (Anthropic)</option>
                                    <option value="openai">OpenAI (GPT-4)</option>
                                </select>
                            </div>

                            {/* API Key Input */}
                            <div className="mb-4">
                                <label className="block text-xs font-semibold text-gray-700 mb-2">
                                    {apiConfig.provider === 'groq' && 'Groq API Key (Get free at console.groq.com)'}
                                    {apiConfig.provider === 'claude' && 'Anthropic API Key (Get at console.anthropic.com)'}
                                    {apiConfig.provider === 'openai' && 'OpenAI API Key (Get at platform.openai.com)'}
                                </label>
                                <input
                                    type="password"
                                    placeholder="Enter your API key here"
                                    className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"
                                    value={apiConfig.apiKey}
                                    onChange={(e) => setApiConfig({...apiConfig, apiKey: e.target.value})}
                                />
                                <p className="text-xs text-gray-600 mt-1">
                                    {!apiConfig.apiKey && '‚ö†Ô∏è API key required to generate content'}
                                    {apiConfig.apiKey && '‚úÖ API key configured'}
                                </p>
                            </div>

                            <hr className="my-6" />

                            <h3 className="text-lg font-semibold text-gray-800 mb-4">‚öôÔ∏è Webflow Configuration (Optional)</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label className="block text-xs font-semibold text-gray-700 mb-1">API Token</label>
                                    <input
                                        type="password"
                                        placeholder="Webflow API token"
                                        className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"
                                        value={webflowConfig.apiToken}
                                        onChange={(e) => setWebflowConfig({...webflowConfig, apiToken: e.target.value})}
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-semibold text-gray-700 mb-1">Collection ID</label>
                                    <input
                                        type="text"
                                        placeholder="Collection ID"
                                        className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"
                                        value={webflowConfig.collectionId}
                                        onChange={(e) => setWebflowConfig({...webflowConfig, collectionId: e.target.value})}
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-semibold text-gray-700 mb-1">Site ID (Optional)</label>
                                    <input
                                        type="text"
                                        placeholder="Site ID"
                                        className="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"
                                        value={webflowConfig.siteId}
                                        onChange={(e) => setWebflowConfig({...webflowConfig, siteId: e.target.value})}
                                    />
                                </div>
                            </div>
                            <p className="text-xs text-gray-600 mt-3">
                                üí° Leave Webflow fields blank to test in demo mode. Once configured, publishing will be automated.
                            </p>
                        </div>
                    </div>

                    {/* Success Modal */}
                    {showSuccess && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-2xl p-8 max-w-md mx-4 text-center shadow-2xl">
                                <div className="text-6xl mb-4">üéâ</div>
                                <h3 className="text-2xl font-bold text-gray-800 mb-2">Published Successfully!</h3>
                                <p className="text-gray-600">Your blog post is ready</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<BlogAutomator />, document.getElementById('root'));
    </script>
</body>
</html>